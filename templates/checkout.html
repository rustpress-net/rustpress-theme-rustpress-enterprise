{% extends "templates/base.html" %}

{% block title %}Checkout - {{ site.name | default(value="RustPress") }}{% endblock %}

{% block head %}
<meta name="stripe-public-key" content="{{ site.stripe_public_key | default(value='pk_test_XXXXXXXXXXXXXXXXXXXXXXXX') }}">
<script src="https://js.stripe.com/v3/"></script>
{% endblock %}

{% block content %}
<main class="main-content">
  <!-- Checkout Header -->
  <section class="checkout-header">
    <div class="container">
      <div class="checkout-header-content" data-animate="fade-up">
        <a href="/pricing" class="back-link">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
          Back to Pricing
        </a>
        <h1 class="checkout-title">Complete Your <span class="text-gradient">Subscription</span></h1>
      </div>
    </div>
  </section>

  <!-- Checkout Content -->
  <section class="checkout-content section">
    <div class="container">
      <div class="checkout-grid">
        <!-- Order Summary -->
        <div class="order-summary" data-animate="fade-right">
          <h2 class="summary-title">Order Summary</h2>

          <div class="selected-plan" id="selected-plan">
            <div class="plan-info">
              <h3 class="plan-name-display" id="selected-plan-name">Business</h3>
              <p class="plan-description-display">For teams and growing companies</p>
            </div>
            <div class="plan-pricing-display">
              <span class="amount" id="plan-price">$49</span>
              <span class="period" id="billing-cycle-text">/month</span>
            </div>
          </div>

          <!-- Plan Selection -->
          <div class="plan-selection">
            <h4>Select Membership</h4>
            <div class="plan-options">
              <button type="button" class="plan-option" data-plan="developer">
                <span class="plan-option-name">Developer</span>
                <span class="plan-option-price">$19/mo</span>
              </button>
              <button type="button" class="plan-option selected" data-plan="business">
                <span class="plan-option-name">Business</span>
                <span class="plan-option-price">$49/mo</span>
              </button>
              <button type="button" class="plan-option" data-plan="enterprise">
                <span class="plan-option-name">Enterprise</span>
                <span class="plan-option-price">Custom</span>
              </button>
            </div>
          </div>

          <div id="yearly-savings" class="yearly-savings" style="display: none;"></div>

          <!-- Plan Features -->
          <div class="plan-features-summary">
            <h4>What's Included:</h4>
            <ul id="plan-features-list">
              <li>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
                Unlimited posts & pages
              </li>
              <li>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
                25GB media storage
              </li>
              <li>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
                Premium themes
              </li>
              <li>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
                AI writing assistant
              </li>
              <li>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
                Custom domain
              </li>
            </ul>
          </div>

          <!-- Billing Cycle Toggle -->
          <div class="billing-cycle">
            <h4>Billing Cycle</h4>
            <div class="billing-toggle-wrapper">
              <span class="billing-label">Monthly</span>
              <label class="billing-toggle">
                <input type="checkbox" id="billing-toggle" checked>
                <span class="toggle-slider"></span>
              </label>
              <span class="billing-label">
                Yearly
                <span class="save-badge">Save 17%</span>
              </span>
            </div>
          </div>

          <!-- Promo Code -->
          <div class="promo-code">
            <h4>Promo Code</h4>
            <div class="promo-input-group">
              <input type="text" id="promo-code" placeholder="Enter code" class="input">
              <button type="button" id="apply-promo" class="btn btn--outline">Apply</button>
            </div>
            <p class="promo-message" id="promo-message"></p>
          </div>

          <!-- Total -->
          <div class="order-total-section">
            <div class="total-row subtotal">
              <span>Subtotal</span>
              <span id="subtotal">$490.00</span>
            </div>
            <div class="total-row discount" id="discount-row" style="display: none;">
              <span>Promo Discount</span>
              <span id="discount-amount" class="discount-value">-$0.00</span>
            </div>
            <div class="total-row total">
              <span>Total Due Today</span>
              <span id="order-total">$490.00</span>
            </div>
          </div>
        </div>

        <!-- Payment Form -->
        <div class="payment-form-wrapper" data-animate="fade-left">
          <h2 class="form-title">Payment Details</h2>

          <form id="payment-form" class="payment-form">
            <!-- Validation Errors -->
            <div id="validation-errors" class="validation-errors" style="display: none;"></div>

            <!-- Payment Error -->
            <div id="payment-error" class="payment-error" style="display: none;"></div>

            <!-- Account Information -->
            <div class="form-section">
              <h3 class="section-title-small">Account Information</h3>
              <div class="form-row">
                <div class="input-group">
                  <label class="input-label" for="email">Email Address</label>
                  <input type="email" id="email" name="email" class="input" placeholder="you@example.com" required>
                </div>
              </div>
              <div class="form-row form-row--2col">
                <div class="input-group">
                  <label class="input-label" for="full-name">Full Name</label>
                  <input type="text" id="full-name" name="full_name" class="input" placeholder="John Doe" required>
                </div>
                <div class="input-group">
                  <label class="input-label" for="company">Company (Optional)</label>
                  <input type="text" id="company" name="company" class="input" placeholder="Acme Inc.">
                </div>
              </div>
            </div>

            <!-- Payment Information -->
            <div class="form-section">
              <h3 class="section-title-small">Payment Method</h3>

              <!-- Payment Method Tabs -->
              <div class="payment-methods">
                <button type="button" class="payment-method active" data-method="card">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                  Credit Card
                </button>
                <button type="button" class="payment-method" data-method="paypal">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797H9.017c-.576 0-1.063.4-1.15.963L6.74 21.337h.335zm7.38-15.68H8.938c-.096 0-.178.07-.19.165l-.992 6.13c-.01.075.047.144.124.144h2.768c2.755 0 4.907-1.126 5.47-4.355.024-.134.04-.265.055-.393.19-1.534-.458-1.69-1.717-1.69z"/></svg>
                  PayPal
                </button>
              </div>

              <!-- Card Payment Form -->
              <div id="card-payment" class="payment-method-content">
                <div class="form-row">
                  <div class="input-group">
                    <label class="input-label" for="card-element">Card Information</label>
                    <div id="card-element" class="stripe-element"></div>
                    <div id="card-errors" class="error-message" role="alert"></div>
                  </div>
                </div>

                <div class="form-row">
                  <div class="input-group">
                    <label class="input-label" for="card-name">Name on Card</label>
                    <input type="text" id="card-name" name="card_name" class="input" placeholder="John Doe" required>
                  </div>
                </div>
              </div>

              <!-- PayPal Content -->
              <div id="paypal-payment" class="payment-method-content hidden">
                <div class="paypal-info">
                  <p>You'll be redirected to PayPal to complete your purchase securely.</p>
                  <div id="paypal-button-container"></div>
                </div>
              </div>
            </div>

            <!-- Billing Address -->
            <div class="form-section">
              <h3 class="section-title-small">Billing Address</h3>
              <div class="form-row">
                <div class="input-group">
                  <label class="input-label" for="address">Street Address</label>
                  <input type="text" id="address" name="address" class="input" placeholder="123 Main St">
                </div>
              </div>
              <div class="form-row form-row--3col">
                <div class="input-group">
                  <label class="input-label" for="city">City</label>
                  <input type="text" id="city" name="city" class="input" placeholder="New York">
                </div>
                <div class="input-group">
                  <label class="input-label" for="state">State</label>
                  <input type="text" id="state" name="state" class="input" placeholder="NY">
                </div>
                <div class="input-group">
                  <label class="input-label" for="country">Country</label>
                  <select id="country" name="country" class="input select">
                    <option value="US">United States</option>
                    <option value="CA">Canada</option>
                    <option value="GB">United Kingdom</option>
                    <option value="DE">Germany</option>
                    <option value="FR">France</option>
                    <option value="AU">Australia</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Terms -->
            <div class="form-section">
              <label class="checkbox-label">
                <input type="checkbox" id="accept-terms" name="terms" required>
                <span class="checkbox-custom"></span>
                <span>I agree to the <a href="https://github.com/nicholaswinton2/RustPress/blob/main/LICENSE" target="_blank" rel="noopener">Terms of Service</a> and <a href="https://github.com/nicholaswinton2/RustPress/blob/main/PRIVACY.md" target="_blank" rel="noopener">Privacy Policy</a></span>
              </label>
            </div>

            <!-- Submit Button -->
            <button type="submit" id="submit-payment" class="btn btn--primary btn--xl btn--block btn--glow">
              <span id="button-text">Subscribe Now</span>
              <span id="button-spinner" class="spinner hidden"></span>
            </button>

            <!-- Security Note -->
            <div class="security-note">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              <span>Your payment is secured with 256-bit SSL encryption</span>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Trust Badges -->
  <section class="trust-badges">
    <div class="container">
      <div class="badges-row">
        <div class="trust-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          <span>Secure Payment</span>
        </div>
        <div class="trust-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          <span>30-Day Guarantee</span>
        </div>
        <div class="trust-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
          <span>Cancel Anytime</span>
        </div>
        <div class="trust-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
          <span>24/7 Support</span>
        </div>
      </div>
    </div>
  </section>
</main>
{% endblock %}

{% block styles %}
<style>
.checkout-header {
  padding: var(--space-8) 0;
  background: var(--gradient-dark);
}

.checkout-header-content {
  max-width: 1200px;
  margin: 0 auto;
}

.back-link {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  margin-bottom: var(--space-4);
}

.back-link:hover {
  color: var(--color-rust-light);
}

.checkout-title {
  font-size: var(--text-3xl);
  font-weight: var(--weight-bold);
}

/* Checkout Grid */
.checkout-grid {
  display: grid;
  grid-template-columns: 400px 1fr;
  gap: var(--space-12);
  max-width: 1100px;
  margin: 0 auto;
}

/* Order Summary */
.order-summary {
  background: var(--color-bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-2xl);
  padding: var(--space-8);
  position: sticky;
  top: var(--space-24);
  height: fit-content;
}

.summary-title {
  font-size: var(--text-xl);
  font-weight: var(--weight-semibold);
  margin-bottom: var(--space-6);
}

.selected-plan {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: var(--space-4);
  background: var(--color-bg-tertiary);
  border-radius: var(--radius-lg);
  margin-bottom: var(--space-6);
}

.plan-name-display {
  font-size: var(--text-lg);
  font-weight: var(--weight-semibold);
  margin-bottom: var(--space-1);
}

.plan-description-display {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
}

.plan-pricing-display .amount {
  font-size: var(--text-2xl);
  font-weight: var(--weight-bold);
  color: var(--color-rust);
}

.plan-pricing-display .period {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
}

/* Plan Features Summary */
.plan-features-summary h4,
.billing-cycle h4,
.promo-code h4 {
  font-size: var(--text-sm);
  font-weight: var(--weight-semibold);
  color: var(--color-text-muted);
  margin-bottom: var(--space-3);
}

.plan-features-summary ul {
  list-style: none;
  padding: 0;
  margin: 0 0 var(--space-6);
}

.plan-features-summary li {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-size: var(--text-sm);
  padding: var(--space-2) 0;
}

.plan-features-summary svg {
  color: var(--color-rust);
}

/* Billing Options */
.billing-cycle {
  margin-bottom: var(--space-6);
}

.billing-options {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.billing-option-radio {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3) var(--space-4);
  background: var(--color-bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
}

.billing-option-radio:hover,
.billing-option-radio:has(input:checked) {
  border-color: var(--color-rust);
}

.billing-option-radio input {
  display: none;
}

.radio-custom {
  width: 18px;
  height: 18px;
  border: 2px solid var(--border-color);
  border-radius: 50%;
  position: relative;
}

.billing-option-radio:has(input:checked) .radio-custom {
  border-color: var(--color-rust);
}

.billing-option-radio:has(input:checked) .radio-custom::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 8px;
  height: 8px;
  background: var(--color-rust);
  border-radius: 50%;
}

.option-content {
  flex: 1;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.option-label {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-size: var(--text-sm);
  font-weight: var(--weight-medium);
}

.save-badge {
  background: var(--color-rust);
  color: white;
  padding: 2px 6px;
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: var(--weight-semibold);
}

.option-price {
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
}

/* Promo Code */
.promo-code {
  margin-bottom: var(--space-6);
  padding-bottom: var(--space-6);
  border-bottom: 1px solid var(--border-color);
}

.promo-input-group {
  display: flex;
  gap: var(--space-2);
}

.promo-input-group .input {
  flex: 1;
}

.promo-message {
  font-size: var(--text-sm);
  margin-top: var(--space-2);
}

.promo-message.success {
  color: #27ca40;
}

.promo-message.error {
  color: #ff5f56;
}

/* Order Total */
.order-total {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.total-row {
  display: flex;
  justify-content: space-between;
  font-size: var(--text-sm);
}

.total-row.total {
  font-size: var(--text-lg);
  font-weight: var(--weight-bold);
  padding-top: var(--space-3);
  border-top: 1px solid var(--border-color);
}

.total-row.discount span:last-child {
  color: #27ca40;
}

/* Payment Form */
.payment-form-wrapper {
  background: var(--color-bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-2xl);
  padding: var(--space-8);
}

.form-title {
  font-size: var(--text-xl);
  font-weight: var(--weight-semibold);
  margin-bottom: var(--space-6);
}

.form-section {
  margin-bottom: var(--space-6);
}

.section-title-small {
  font-size: var(--text-sm);
  font-weight: var(--weight-semibold);
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: var(--tracking-wider);
  margin-bottom: var(--space-4);
}

.form-row {
  margin-bottom: var(--space-4);
}

.form-row--2col {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-4);
}

.form-row--3col {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: var(--space-4);
}

/* Payment Methods */
.payment-methods {
  display: flex;
  gap: var(--space-3);
  margin-bottom: var(--space-4);
}

.payment-method {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  padding: var(--space-3);
  background: var(--color-bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  font-size: var(--text-sm);
  font-weight: var(--weight-medium);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
}

.payment-method:hover {
  border-color: var(--color-rust);
}

.payment-method.active {
  border-color: var(--color-rust);
  background: rgba(206, 66, 43, 0.1);
}

.payment-method-content.hidden {
  display: none;
}

/* Stripe Element */
.stripe-element {
  padding: var(--space-4);
  background: var(--color-bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
}

.stripe-element.StripeElement--focus {
  border-color: var(--color-rust);
}

.error-message {
  color: #ff5f56;
  font-size: var(--text-sm);
  margin-top: var(--space-2);
}

/* Checkbox */
.checkbox-label {
  display: flex;
  align-items: flex-start;
  gap: var(--space-3);
  font-size: var(--text-sm);
  cursor: pointer;
}

.checkbox-label input {
  display: none;
}

.checkbox-custom {
  width: 18px;
  height: 18px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  flex-shrink: 0;
  position: relative;
  transition: all var(--duration-fast) var(--ease-out);
}

.checkbox-label:has(input:checked) .checkbox-custom {
  background: var(--color-rust);
  border-color: var(--color-rust);
}

.checkbox-label:has(input:checked) .checkbox-custom::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.checkbox-label a {
  color: var(--color-rust-light);
  text-decoration: underline;
}

/* Security Note */
.security-note {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  margin-top: var(--space-4);
  font-size: var(--text-xs);
  color: var(--color-text-muted);
}

/* Spinner */
.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid white;
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.spinner.hidden {
  display: none;
}

/* Trust Badges */
.trust-badges {
  padding: var(--space-12) 0;
  background: var(--color-bg-secondary);
}

.badges-row {
  display: flex;
  justify-content: center;
  gap: var(--space-12);
}

.trust-badge {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-size: var(--text-sm);
  color: var(--color-text-muted);
}

.trust-badge svg {
  color: var(--color-rust);
}

/* PayPal */
.paypal-info {
  text-align: center;
  padding: var(--space-6);
}

.paypal-info p {
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-4);
}

/* Validation & Payment Errors */
.validation-errors,
.payment-error {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: var(--radius-lg);
  padding: var(--space-4);
  margin-bottom: var(--space-6);
  color: #ef4444;
}

.validation-errors ul {
  margin: 0;
  padding-left: var(--space-4);
}

.validation-errors li {
  font-size: var(--text-sm);
  margin-bottom: var(--space-1);
}

/* Plan Selection */
.plan-selection {
  margin-bottom: var(--space-6);
}

.plan-selection h4 {
  font-size: var(--text-sm);
  font-weight: var(--weight-semibold);
  color: var(--color-text-muted);
  margin-bottom: var(--space-3);
}

.plan-options {
  display: flex;
  gap: var(--space-2);
}

.plan-option {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-3);
  background: var(--color-bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
}

.plan-option:hover {
  border-color: var(--color-rust);
}

.plan-option.selected {
  border-color: var(--color-rust);
  background: rgba(206, 66, 43, 0.1);
}

.plan-option-name {
  font-size: var(--text-sm);
  font-weight: var(--weight-semibold);
}

.plan-option-price {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
}

/* Yearly Savings */
.yearly-savings {
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.3);
  border-radius: var(--radius-lg);
  padding: var(--space-3);
  margin-bottom: var(--space-6);
  font-size: var(--text-sm);
  color: #10b981;
  text-align: center;
}

/* Billing Toggle */
.billing-toggle-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-3);
}

.billing-label {
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.billing-toggle {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 24px;
}

.billing-toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--color-bg-tertiary);
  border: 1px solid var(--border-color);
  border-radius: 24px;
  transition: all var(--duration-fast) var(--ease-out);
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 2px;
  bottom: 2px;
  background: white;
  border-radius: 50%;
  transition: all var(--duration-fast) var(--ease-out);
}

.billing-toggle input:checked + .toggle-slider {
  background: var(--color-rust);
  border-color: var(--color-rust);
}

.billing-toggle input:checked + .toggle-slider:before {
  transform: translateX(24px);
}

/* Order Total Section */
.order-total-section {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.discount-value {
  color: #10b981;
}

@media (max-width: 1024px) {
  .checkout-grid {
    grid-template-columns: 1fr;
  }

  .order-summary {
    position: static;
    order: -1;
  }
}

@media (max-width: 768px) {
  .checkout-title {
    font-size: var(--text-2xl);
  }

  .form-row--2col,
  .form-row--3col {
    grid-template-columns: 1fr;
  }

  .badges-row {
    flex-wrap: wrap;
    gap: var(--space-6);
  }
}
</style>
{% endblock %}

{% block scripts %}
<script src="/themes/rustpress-enterprise/assets/js/stripe.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Payment method tabs
  const paymentMethods = document.querySelectorAll('.payment-method');
  paymentMethods.forEach(method => {
    method.addEventListener('click', function() {
      paymentMethods.forEach(m => m.classList.remove('active'));
      this.classList.add('active');

      const methodType = this.dataset.method;
      document.getElementById('card-payment').classList.toggle('hidden', methodType !== 'card');
      document.getElementById('paypal-payment').classList.toggle('hidden', methodType !== 'paypal');
    });
  });

  // Update plan features list when plan changes
  function updateFeaturesList(planId) {
    const featuresList = document.getElementById('plan-features-list');
    if (!featuresList || !window.rustPressPayments) return;

    const plan = window.rustPressPayments.getPlanDetails(planId);
    if (!plan) return;

    featuresList.innerHTML = plan.features.map(feature => `
      <li>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
        ${feature}
      </li>
    `).join('');

    // Update description
    const descriptions = {
      developer: 'For individual developers and freelancers',
      business: 'For teams and growing companies',
      enterprise: 'For large organizations with custom needs'
    };
    const descEl = document.querySelector('.plan-description-display');
    if (descEl) {
      descEl.textContent = descriptions[planId] || '';
    }
  }

  // Listen for plan selection
  document.querySelectorAll('[data-plan]').forEach(button => {
    button.addEventListener('click', () => {
      const planId = button.dataset.plan;
      updateFeaturesList(planId);
    });
  });

  // Initialize with URL param or default
  setTimeout(() => {
    const urlParams = new URLSearchParams(window.location.search);
    const plan = urlParams.get('plan') || 'business';
    if (window.rustPressPayments) {
      window.rustPressPayments.selectPlan(plan);
      updateFeaturesList(plan);
    }
  }, 100);
});
</script>
{% endblock %}
