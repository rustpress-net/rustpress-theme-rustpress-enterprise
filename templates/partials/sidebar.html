<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
  {% if widgets %}
    {% for widget in widgets %}
      <div class="sidebar-widget" data-animate="fade-up">
        {% if widget.title %}
          <h3 class="widget-title">{{ widget.title }}</h3>
        {% endif %}
        <div class="widget-content">
          {{ widget.content | safe }}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <!-- Default Widgets -->

    <!-- Search Widget -->
    <div class="sidebar-widget" data-animate="fade-up">
      <h3 class="widget-title">Search</h3>
      <div class="widget-content">
        <form class="search-form" action="/search" method="GET">
          <div class="search-input-wrapper">
            <input type="search" name="q" class="input" placeholder="Search...">
            <button type="submit" class="search-btn" aria-label="Search">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Categories Widget -->
    <div class="sidebar-widget" data-animate="fade-up">
      <h3 class="widget-title">Categories</h3>
      <div class="widget-content">
        <ul class="category-list">
          {% if categories %}
            {% for category in categories %}
              <li>
                <a href="/category/{{ category.slug }}">
                  {{ category.name }}
                  <span class="count">{{ category.count }}</span>
                </a>
              </li>
            {% endfor %}
          {% else %}
            <li><a href="/category/tutorials">Tutorials <span class="count">12</span></a></li>
            <li><a href="/category/updates">Updates <span class="count">8</span></a></li>
            <li><a href="/category/guides">Guides <span class="count">15</span></a></li>
            <li><a href="/category/news">News <span class="count">6</span></a></li>
            <li><a href="/category/community">Community <span class="count">4</span></a></li>
          {% endif %}
        </ul>
      </div>
    </div>

    <!-- Recent Posts Widget -->
    <div class="sidebar-widget" data-animate="fade-up">
      <h3 class="widget-title">Recent Posts</h3>
      <div class="widget-content">
        <ul class="recent-posts">
          {% if recent_posts %}
            {% for post in recent_posts | slice(end=5) %}
              <li>
                <a href="{{ post.url }}">
                  <span class="post-title">{{ post.title }}</span>
                  <span class="post-date">{{ post.date | date(format="M d, Y") }}</span>
                </a>
              </li>
            {% endfor %}
          {% else %}
            <li>
              <a href="/blog/getting-started-with-rustpress">
                <span class="post-title">Getting Started with RustPress</span>
                <span class="post-date">Jan 15, 2024</span>
              </a>
            </li>
            <li>
              <a href="/blog/ai-tools-overview">
                <span class="post-title">AI Tools Overview</span>
                <span class="post-date">Jan 12, 2024</span>
              </a>
            </li>
            <li>
              <a href="/blog/building-themes">
                <span class="post-title">Building Custom Themes</span>
                <span class="post-date">Jan 10, 2024</span>
              </a>
            </li>
          {% endif %}
        </ul>
      </div>
    </div>

    <!-- Tags Widget -->
    <div class="sidebar-widget" data-animate="fade-up">
      <h3 class="widget-title">Tags</h3>
      <div class="widget-content">
        <div class="tag-cloud">
          {% if tags %}
            {% for tag in tags %}
              <a href="/tag/{{ tag.slug }}" class="tag">{{ tag.name }}</a>
            {% endfor %}
          {% else %}
            <a href="/tag/rust" class="tag">Rust</a>
            <a href="/tag/cms" class="tag">CMS</a>
            <a href="/tag/ai" class="tag tag--rust">AI</a>
            <a href="/tag/themes" class="tag">Themes</a>
            <a href="/tag/plugins" class="tag">Plugins</a>
            <a href="/tag/tutorial" class="tag">Tutorial</a>
            <a href="/tag/performance" class="tag">Performance</a>
            <a href="/tag/security" class="tag">Security</a>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Newsletter Widget -->
    <div class="sidebar-widget sidebar-widget--featured" data-animate="fade-up">
      <h3 class="widget-title">Newsletter</h3>
      <div class="widget-content">
        <p>Get the latest updates and tips delivered to your inbox.</p>
        <form class="newsletter-widget-form" action="/api/newsletter" method="POST">
          <input type="email" name="email" class="input" placeholder="Your email" required>
          <button type="submit" class="btn btn--primary btn--block">Subscribe</button>
        </form>
      </div>
    </div>

  {% endif %}
</aside>

<style>
.sidebar {
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
}

.sidebar-widget {
  background: var(--color-bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-xl);
  padding: var(--space-6);
}

.sidebar-widget--featured {
  background: linear-gradient(135deg, rgba(206, 66, 43, 0.1) 0%, rgba(233, 116, 81, 0.05) 100%);
  border-color: var(--border-rust);
}

.widget-title {
  font-size: var(--text-sm);
  font-weight: var(--weight-semibold);
  text-transform: uppercase;
  letter-spacing: var(--tracking-wider);
  color: var(--color-text-muted);
  margin-bottom: var(--space-4);
  padding-bottom: var(--space-3);
  border-bottom: 1px solid var(--border-color);
}

.widget-content p {
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-4);
}

/* Search */
.search-input-wrapper {
  position: relative;
}

.search-input-wrapper .input {
  padding-right: 44px;
}

.search-btn {
  position: absolute;
  right: 4px;
  top: 50%;
  transform: translateY(-50%);
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-rust);
  color: white;
  border-radius: var(--radius-md);
  transition: background var(--duration-fast) var(--ease-out);
}

.search-btn:hover {
  background: var(--color-rust-light);
}

/* Categories */
.category-list li {
  border-bottom: 1px solid var(--border-color);
}

.category-list li:last-child {
  border-bottom: none;
}

.category-list a {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-3) 0;
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  transition: color var(--duration-fast) var(--ease-out);
}

.category-list a:hover {
  color: var(--color-rust-light);
}

.category-list .count {
  font-size: var(--text-xs);
  background: var(--color-bg-tertiary);
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-full);
}

/* Recent Posts */
.recent-posts li {
  border-bottom: 1px solid var(--border-color);
}

.recent-posts li:last-child {
  border-bottom: none;
}

.recent-posts a {
  display: block;
  padding: var(--space-3) 0;
}

.recent-posts .post-title {
  display: block;
  font-size: var(--text-sm);
  font-weight: var(--weight-medium);
  color: var(--color-text-primary);
  margin-bottom: var(--space-1);
  transition: color var(--duration-fast) var(--ease-out);
}

.recent-posts a:hover .post-title {
  color: var(--color-rust-light);
}

.recent-posts .post-date {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
}

/* Tag Cloud */
.tag-cloud {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
}

/* Newsletter Widget */
.newsletter-widget-form {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}
</style>
